{"ast":null,"code":"var _jsxFileName = \"/Users/stephan/Dropbox/Entwicklung/webdev/projektstudium/client/src/components/Documents/InvoiceForm.jsx\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect } from \"react\";\nimport { MDBContainer, MDBRow, MDBCol, MDBInput, MDBBtn, MDBBadge } from \"mdb-react-ui-kit\";\nimport { init, createRechnung, createZollanmeldung } from \"../../Web3Client\";\nimport { useParams } from \"react-router-dom\";\nimport \"json2csv\";\nimport LZString from \"lz-string\";\nimport useAxiosPrivate from \"../../hooks/useAxiosPrivate\";\nimport Backdrop from \"@mui/material/Backdrop\";\nimport CircularProgress from \"@mui/material/CircularProgress\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nvar crypto = require(\"crypto\");\n\nvar blockchaintx = \"\";\n\nfunction InvoiceForm(props) {\n  _s();\n\n  // Das hier spuckt tausende Logs aus und mindert die Performance:\n  // useEffect() Hook nutzen?\n  const axiosInstance = useAxiosPrivate();\n  const [invoiceFields, setInvoiceFields] = useState({\n    type: \"Rechnung\",\n    description: \"\",\n    blockchainID: blockchaintx,\n    issue_date: \"\",\n    invoice_text: \"\",\n    currency: \"\",\n    transaction: \"\",\n    invoiceItem: [],\n    priceTotal: \"\",\n    transport_costs: \"\"\n  });\n  const [invoiceItemFields, setInvoiceItemFields] = useState([{\n    product: \"\",\n    amount: \"\",\n    unit: \"\",\n    price: \"\"\n  }]);\n  const {\n    transactionId\n  } = useParams(); // -- Loading Backdrop --\n\n  const [openBackdrop, setOpenBackdrop] = React.useState(false);\n\n  const handleCloseBackdrop = () => {\n    setOpenBackdrop(false);\n  };\n\n  const handleToggleBackdrop = () => {\n    setOpenBackdrop(!openBackdrop);\n  }; //Debugging\n\n\n  useEffect(() => {\n    var _props$transactionDat;\n\n    console.log(props.transactionData);\n    console.log((_props$transactionDat = props.transactionData) === null || _props$transactionDat === void 0 ? void 0 : _props$transactionDat.partnership.partner.blockchain_id);\n  }, []);\n\n  function handleItemChange(index, event) {\n    const values = [...invoiceItemFields];\n    values[index][event.target.name] = event.target.value;\n    setInvoiceItemFields(values);\n    console.log(invoiceItemFields);\n    invoiceFields.invoiceItem = invoiceItemFields;\n    console.log(invoiceFields);\n    setInvoiceFields({ ...invoiceFields,\n      transaction: transactionId\n    });\n  }\n\n  async function handleSubmit(e) {\n    var _props$transactionDat2, _props$transactionDat3;\n\n    e.preventDefault();\n    handleToggleBackdrop();\n\n    var crypto = require(\"crypto\");\n\n    let total = calculatePriceTotal();\n    console.log(\"Gesamtbetrag\" + total); //Blockchain Transaktion\n\n    console.log(props.transactionData);\n    console.log((_props$transactionDat2 = props.transactionData) === null || _props$transactionDat2 === void 0 ? void 0 : _props$transactionDat2.partnership.partner.publickey);\n    createRechnung(total.toString(), (_props$transactionDat3 = props.transactionData) === null || _props$transactionDat3 === void 0 ? void 0 : _props$transactionDat3.partnership.partner.publickey, invoiceFields.currency, invoiceFields.issue_date, crypto.createHash(\"sha512\").update(invoiceItemFields).digest(\"hex\"), invoiceFields.transport_costs).then(tx => {\n      console.log(\"Transaktion erfolgreich: \" + tx);\n      blockchaintx = tx; //Übermittel und anlegen der Rechnung\n\n      axiosInstance.post(\"/invoice/\", {\n        blockchain_id: tx - 1,\n        currency: invoiceFields.currency,\n        description: invoiceFields.description,\n        invoiceItem: invoiceFields.invoiceItem,\n        invoice_text: invoiceFields.invoice_text,\n        issue_date: invoiceFields.issue_date,\n        priceTotal: invoiceFields.priceTotal,\n        transaction: invoiceFields.transaction,\n        transport_costs: invoiceFields.transport_costs,\n        type: invoiceFields.type\n      }).then(res => {\n        console.log(\"Rechnung erfolgreich hochgeladen.\");\n        props.setNewDocument(!props.newDocument);\n        props.setSnackbarSuccess(true);\n        props.setSnackbarMessage(\"Rechnung erfolgreich hochgeladen.\");\n        handleCloseBackdrop();\n        props.handleOpenSnackbar();\n        props.setNewDocument(!props.newDocument);\n        props.toggleAddDocumentModal();\n      }).catch(error => {\n        console.error(\"There was an error!\", error);\n        props.setSnackbarSuccess(false);\n        props.setSnackbarMessage(\"Fehler beim hochladen der Rechnung.\");\n        handleCloseBackdrop();\n        props.handleOpenSnackbar();\n        props.toggleAddDocumentModal();\n      });\n    }).catch(err => {\n      console.log(\"Transaktion fehlgeschlagen: \" + \"  \" + err);\n      props.setSnackbarSuccess(false);\n      props.setSnackbarMessage(\"Fehler bei der Verarbeitung der Rechnung.\");\n      handleCloseBackdrop();\n      props.handleOpenSnackbar();\n      props.toggleAddDocumentModal();\n    });\n  }\n\n  function handleAddFields(event) {\n    event.preventDefault();\n    setInvoiceItemFields([...invoiceItemFields, {\n      product: \"\",\n      amount: \"\",\n      unit: \"\",\n      price: \"\"\n    }]);\n  }\n\n  function handleRemoveFields(event, index) {\n    event.preventDefault();\n    const values = [...invoiceItemFields]; // values.splice(index, 1);\n\n    values.splice(values.findIndex(value => value.index === index), 1);\n    setInvoiceItemFields(values);\n  }\n\n  function calculatePriceTotal() {\n    const items = invoiceItemFields;\n    let total = 0;\n\n    for (let i = 0; i < items.length; i++) {\n      total += items[i].amount * items[i].price;\n    }\n\n    setInvoiceFields({ ...items,\n      priceTotal: total\n    });\n    return total;\n  }\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(MDBContainer, {\n      children: [/*#__PURE__*/_jsxDEV(MDBRow, {\n        children: [/*#__PURE__*/_jsxDEV(MDBCol, {\n          children: /*#__PURE__*/_jsxDEV(MDBInput, {\n            className: \"mb-4\",\n            name: \"issue_date\",\n            id: \"issue_date\",\n            label: \"Rechnungsdatum\",\n            type: \"date\",\n            onChange: e => setInvoiceFields({ ...invoiceFields,\n              issue_date: e.target.value\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 177,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 176,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(MDBCol, {\n          children: /*#__PURE__*/_jsxDEV(MDBInput, {\n            className: \"mb-4\",\n            name: \"currency\",\n            id: \"currency\",\n            label: \"W\\xE4hrung\",\n            type: \"text\",\n            onChange: e => setInvoiceFields({ ...invoiceFields,\n              currency: e.target.value\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 192,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 191,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(MDBCol, {\n          children: /*#__PURE__*/_jsxDEV(MDBInput, {\n            className: \"mb-4\",\n            name: \"transport_costs\",\n            id: \"transport_costs\",\n            label: \"Lieferkosten\",\n            type: \"number\",\n            onChange: e => setInvoiceFields({ ...invoiceFields,\n              transport_costs: e.target.value\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 204,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 203,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 175,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(MDBInput, {\n        wrapperClass: \"mb-4\",\n        textarea: true,\n        name: \"description\",\n        id: \"description\",\n        rows: 3,\n        label: \"Beschreibung (optional)\",\n        onChange: e => setInvoiceFields({ ...invoiceFields,\n          description: e.target.value\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 219,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"hr\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 230,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n        children: [invoiceItemFields.map((inputField, index) => /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"h6\", {\n            children: [\"Rechnungsposten \", index + 1]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 235,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(MDBInput, {\n            className: \"mb-4\",\n            name: \"product\",\n            label: \"Produktname\",\n            type: \"text\",\n            value: inputField.product,\n            onChange: event => handleItemChange(index, event)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 236,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(MDBRow, {\n            children: [/*#__PURE__*/_jsxDEV(MDBCol, {\n              children: /*#__PURE__*/_jsxDEV(MDBInput, {\n                className: \"mb-4\",\n                name: \"amount\",\n                label: \"Anzahl\",\n                type: \"number\",\n                value: inputField.amount,\n                onChange: event => handleItemChange(index, event)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 246,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 245,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(MDBCol, {\n              children: /*#__PURE__*/_jsxDEV(MDBInput, {\n                className: \"mb-4\",\n                name: \"unit\",\n                label: \"Einheit\",\n                type: \"text\",\n                value: inputField.unit,\n                onChange: event => handleItemChange(index, event)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 256,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 255,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(MDBCol, {\n              children: /*#__PURE__*/_jsxDEV(MDBInput, {\n                className: \"mb-4\",\n                name: \"price\",\n                label: \"Preis pro Enheit\",\n                type: \"number\",\n                value: inputField.price,\n                onChange: event => handleItemChange(index, event)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 266,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 265,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(MDBCol, {\n              children: /*#__PURE__*/_jsxDEV(MDBBadge, {\n                className: \"mt-2 me-4 float-end\",\n                color: \"primary\",\n                children: [\"Betrag : \", inputField.amount * inputField.price, \" \", invoiceFields.invoiceCurrency]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 276,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 275,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 244,\n            columnNumber: 15\n          }, this)]\n        }, index, true, {\n          fileName: _jsxFileName,\n          lineNumber: 234,\n          columnNumber: 13\n        }, this)), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 284,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(MDBBtn, {\n          className: \"me-3 mb-3\",\n          color: \"success\",\n          onClick: handleAddFields,\n          children: \"Rechnungsposten hinzuf\\xFCgen\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 286,\n          columnNumber: 11\n        }, this), invoiceItemFields.length > 1 && /*#__PURE__*/_jsxDEV(MDBBtn, {\n          className: \"me-3 mb-3\",\n          color: \"danger\",\n          onClick: handleRemoveFields,\n          children: \"Rechnungsposten entfernen\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 294,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(MDBBtn, {\n          className: \"float-end\",\n          color: \"primary\",\n          onClick: handleSubmit,\n          children: \"Abschicken\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 303,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 232,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 174,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Backdrop, {\n      sx: {\n        color: \"#fff\",\n        zIndex: theme => theme.zIndex.drawer + 1\n      },\n      open: openBackdrop,\n      onClick: handleCloseBackdrop,\n      children: /*#__PURE__*/_jsxDEV(CircularProgress, {\n        color: \"inherit\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 315,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 310,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n}\n\n_s(InvoiceForm, \"wcHvKsv9cGEiYT4Ulf2Scx4YL28=\", false, function () {\n  return [useAxiosPrivate, useParams];\n});\n\n_c = InvoiceForm;\nexport default InvoiceForm;\n\nvar _c;\n\n$RefreshReg$(_c, \"InvoiceForm\");","map":{"version":3,"sources":["/Users/stephan/Dropbox/Entwicklung/webdev/projektstudium/client/src/components/Documents/InvoiceForm.jsx"],"names":["React","useState","useEffect","MDBContainer","MDBRow","MDBCol","MDBInput","MDBBtn","MDBBadge","init","createRechnung","createZollanmeldung","useParams","LZString","useAxiosPrivate","Backdrop","CircularProgress","crypto","require","blockchaintx","InvoiceForm","props","axiosInstance","invoiceFields","setInvoiceFields","type","description","blockchainID","issue_date","invoice_text","currency","transaction","invoiceItem","priceTotal","transport_costs","invoiceItemFields","setInvoiceItemFields","product","amount","unit","price","transactionId","openBackdrop","setOpenBackdrop","handleCloseBackdrop","handleToggleBackdrop","console","log","transactionData","partnership","partner","blockchain_id","handleItemChange","index","event","values","target","name","value","handleSubmit","e","preventDefault","total","calculatePriceTotal","publickey","toString","createHash","update","digest","then","tx","post","res","setNewDocument","newDocument","setSnackbarSuccess","setSnackbarMessage","handleOpenSnackbar","toggleAddDocumentModal","catch","error","err","handleAddFields","handleRemoveFields","splice","findIndex","items","i","length","map","inputField","invoiceCurrency","color","zIndex","theme","drawer"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport {\n  MDBContainer,\n  MDBRow,\n  MDBCol,\n  MDBInput,\n  MDBBtn,\n  MDBBadge,\n} from \"mdb-react-ui-kit\";\nimport { init, createRechnung, createZollanmeldung } from \"../../Web3Client\";\nimport { useParams } from \"react-router-dom\";\nimport {} from \"json2csv\";\nimport LZString from \"lz-string\";\nimport useAxiosPrivate from \"../../hooks/useAxiosPrivate\";\nimport Backdrop from \"@mui/material/Backdrop\";\nimport CircularProgress from \"@mui/material/CircularProgress\";\n\nvar crypto = require(\"crypto\");\nvar blockchaintx = \"\";\nfunction InvoiceForm(props) {\n  // Das hier spuckt tausende Logs aus und mindert die Performance:\n  // useEffect() Hook nutzen?\n  const axiosInstance = useAxiosPrivate();\n\n  const [invoiceFields, setInvoiceFields] = useState({\n    type: \"Rechnung\",\n    description: \"\",\n    blockchainID: blockchaintx,\n    issue_date: \"\",\n    invoice_text: \"\",\n    currency: \"\",\n    transaction: \"\",\n    invoiceItem: [],\n    priceTotal: \"\",\n    transport_costs: \"\",\n  });\n\n  const [invoiceItemFields, setInvoiceItemFields] = useState([\n    {\n      product: \"\",\n      amount: \"\",\n      unit: \"\",\n      price: \"\",\n    },\n  ]);\n  const { transactionId } = useParams();\n\n  // -- Loading Backdrop --\n  const [openBackdrop, setOpenBackdrop] = React.useState(false);\n  const handleCloseBackdrop = () => {\n    setOpenBackdrop(false);\n  };\n  const handleToggleBackdrop = () => {\n    setOpenBackdrop(!openBackdrop);\n  };\n\n  //Debugging\n  useEffect(() => {\n    console.log(props.transactionData);\n    console.log(props.transactionData?.partnership.partner.blockchain_id);\n  }, []);\n\n  function handleItemChange(index, event) {\n    const values = [...invoiceItemFields];\n    values[index][event.target.name] = event.target.value;\n    setInvoiceItemFields(values);\n    console.log(invoiceItemFields);\n    invoiceFields.invoiceItem = invoiceItemFields;\n    console.log(invoiceFields);\n    setInvoiceFields({ ...invoiceFields, transaction: transactionId });\n  }\n\n  async function handleSubmit(e) {\n    e.preventDefault();\n    handleToggleBackdrop();\n    var crypto = require(\"crypto\");\n    let total = calculatePriceTotal();\n    console.log(\"Gesamtbetrag\" + total);\n    //Blockchain Transaktion\n    console.log(props.transactionData);\n    console.log(props.transactionData?.partnership.partner.publickey);\n    createRechnung(\n      total.toString(),\n      props.transactionData?.partnership.partner.publickey,\n      invoiceFields.currency,\n      invoiceFields.issue_date,\n      crypto.createHash(\"sha512\").update(invoiceItemFields).digest(\"hex\"),\n      invoiceFields.transport_costs\n    )\n      .then((tx) => {\n        console.log(\"Transaktion erfolgreich: \" + tx);\n        blockchaintx = tx;\n        //Übermittel und anlegen der Rechnung\n        axiosInstance\n          .post(\"/invoice/\", {\n            blockchain_id: tx - 1,\n            currency: invoiceFields.currency,\n            description: invoiceFields.description,\n            invoiceItem: invoiceFields.invoiceItem,\n            invoice_text: invoiceFields.invoice_text,\n            issue_date: invoiceFields.issue_date,\n            priceTotal: invoiceFields.priceTotal,\n            transaction: invoiceFields.transaction,\n            transport_costs: invoiceFields.transport_costs,\n            type: invoiceFields.type,\n          })\n          .then((res) => {\n            console.log(\"Rechnung erfolgreich hochgeladen.\");\n            props.setNewDocument(!props.newDocument);\n            props.setSnackbarSuccess(true);\n            props.setSnackbarMessage(\"Rechnung erfolgreich hochgeladen.\");\n            handleCloseBackdrop();\n            props.handleOpenSnackbar();\n            props.setNewDocument(!props.newDocument);\n            props.toggleAddDocumentModal();\n          })\n          .catch((error) => {\n            console.error(\"There was an error!\", error);\n            props.setSnackbarSuccess(false);\n            props.setSnackbarMessage(\"Fehler beim hochladen der Rechnung.\");\n            handleCloseBackdrop();\n            props.handleOpenSnackbar();\n            props.toggleAddDocumentModal();\n          });\n      })\n      .catch((err) => {\n        console.log(\"Transaktion fehlgeschlagen: \" + \"  \" + err);\n        props.setSnackbarSuccess(false);\n        props.setSnackbarMessage(\"Fehler bei der Verarbeitung der Rechnung.\");\n        handleCloseBackdrop();\n        props.handleOpenSnackbar();\n        props.toggleAddDocumentModal();\n      });\n  }\n\n  function handleAddFields(event) {\n    event.preventDefault();\n    setInvoiceItemFields([\n      ...invoiceItemFields,\n      {\n        product: \"\",\n        amount: \"\",\n        unit: \"\",\n        price: \"\",\n      },\n    ]);\n  }\n\n  function handleRemoveFields(event, index) {\n    event.preventDefault();\n    const values = [...invoiceItemFields];\n    // values.splice(index, 1);\n    values.splice(\n      values.findIndex((value) => value.index === index),\n      1\n    );\n    setInvoiceItemFields(values);\n  }\n\n  function calculatePriceTotal() {\n    const items = invoiceItemFields;\n    let total = 0;\n\n    for (let i = 0; i < items.length; i++) {\n      total += items[i].amount * items[i].price;\n    }\n    setInvoiceFields({ ...items, priceTotal: total });\n\n    return total;\n  }\n\n  return (\n    <>\n      <MDBContainer>\n        <MDBRow>\n          <MDBCol>\n            <MDBInput\n              className=\"mb-4\"\n              name=\"issue_date\"\n              id=\"issue_date\"\n              label=\"Rechnungsdatum\"\n              type=\"date\"\n              onChange={(e) =>\n                setInvoiceFields({\n                  ...invoiceFields,\n                  issue_date: e.target.value,\n                })\n              }\n            />\n          </MDBCol>\n          <MDBCol>\n            <MDBInput\n              className=\"mb-4\"\n              name=\"currency\"\n              id=\"currency\"\n              label=\"Währung\"\n              type=\"text\"\n              onChange={(e) =>\n                setInvoiceFields({ ...invoiceFields, currency: e.target.value })\n              }\n            />\n          </MDBCol>\n          <MDBCol>\n            <MDBInput\n              className=\"mb-4\"\n              name=\"transport_costs\"\n              id=\"transport_costs\"\n              label=\"Lieferkosten\"\n              type=\"number\"\n              onChange={(e) =>\n                setInvoiceFields({\n                  ...invoiceFields,\n                  transport_costs: e.target.value,\n                })\n              }\n            />\n          </MDBCol>\n        </MDBRow>\n        <MDBInput\n          wrapperClass=\"mb-4\"\n          textarea\n          name=\"description\"\n          id=\"description\"\n          rows={3}\n          label=\"Beschreibung (optional)\"\n          onChange={(e) =>\n            setInvoiceFields({ ...invoiceFields, description: e.target.value })\n          }\n        />\n        <hr />\n\n        <form>\n          {invoiceItemFields.map((inputField, index) => (\n            <div key={index}>\n              <h6>Rechnungsposten {index + 1}</h6>\n              <MDBInput\n                className=\"mb-4\"\n                name=\"product\"\n                label=\"Produktname\"\n                type=\"text\"\n                value={inputField.product}\n                onChange={(event) => handleItemChange(index, event)}\n              />\n              <MDBRow>\n                <MDBCol>\n                  <MDBInput\n                    className=\"mb-4\"\n                    name=\"amount\"\n                    label=\"Anzahl\"\n                    type=\"number\"\n                    value={inputField.amount}\n                    onChange={(event) => handleItemChange(index, event)}\n                  />\n                </MDBCol>\n                <MDBCol>\n                  <MDBInput\n                    className=\"mb-4\"\n                    name=\"unit\"\n                    label=\"Einheit\"\n                    type=\"text\"\n                    value={inputField.unit}\n                    onChange={(event) => handleItemChange(index, event)}\n                  />\n                </MDBCol>\n                <MDBCol>\n                  <MDBInput\n                    className=\"mb-4\"\n                    name=\"price\"\n                    label=\"Preis pro Enheit\"\n                    type=\"number\"\n                    value={inputField.price}\n                    onChange={(event) => handleItemChange(index, event)}\n                  />\n                </MDBCol>\n                <MDBCol>\n                  <MDBBadge className=\"mt-2 me-4 float-end\" color=\"primary\">\n                    Betrag : {inputField.amount * inputField.price}{\" \"}\n                    {invoiceFields.invoiceCurrency}\n                  </MDBBadge>\n                </MDBCol>\n              </MDBRow>\n            </div>\n          ))}\n          <br />\n\n          <MDBBtn\n            className=\"me-3 mb-3\"\n            color=\"success\"\n            onClick={handleAddFields}\n          >\n            Rechnungsposten hinzufügen\n          </MDBBtn>\n          {invoiceItemFields.length > 1 && (\n            <MDBBtn\n              className=\"me-3 mb-3\"\n              color=\"danger\"\n              onClick={handleRemoveFields}\n            >\n              Rechnungsposten entfernen\n            </MDBBtn>\n          )}\n\n          <MDBBtn className=\"float-end\" color=\"primary\" onClick={handleSubmit}>\n            Abschicken\n          </MDBBtn>\n        </form>\n      </MDBContainer>\n\n      {/* Loading Backdrop bei Meta Mask Dialog*/}\n      <Backdrop\n        sx={{ color: \"#fff\", zIndex: (theme) => theme.zIndex.drawer + 1 }}\n        open={openBackdrop}\n        onClick={handleCloseBackdrop}\n      >\n        <CircularProgress color=\"inherit\" />\n      </Backdrop>\n    </>\n  );\n}\n\nexport default InvoiceForm;\n"]},"metadata":{},"sourceType":"module"}