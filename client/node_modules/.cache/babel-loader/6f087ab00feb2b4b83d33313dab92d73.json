{"ast":null,"code":"import _asyncToGenerator from\"/Users/stephan/Dropbox/Entwicklung/webdev/projektstudium/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _objectSpread from\"/Users/stephan/Dropbox/Entwicklung/webdev/projektstudium/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _toConsumableArray from\"/Users/stephan/Dropbox/Entwicklung/webdev/projektstudium/client/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _slicedToArray from\"/Users/stephan/Dropbox/Entwicklung/webdev/projektstudium/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/Users/stephan/Dropbox/Entwicklung/webdev/projektstudium/client/node_modules/@babel/runtime/regenerator/index.js\";import React,{useState,useEffect,isValidElement}from\"react\";import{MDBContainer,MDBRow,MDBCol,MDBInput,MDBBtn,MDBBadge,MDBIcon}from\"mdb-react-ui-kit\";import{init,createRechnung,createZollanmeldung}from\"../../Web3Client\";import{useParams}from\"react-router-dom\";import\"json2csv\";import LZString from\"lz-string\";import useAxiosPrivate from\"../../hooks/useAxiosPrivate\";import Backdrop from\"@mui/material/Backdrop\";import CircularProgress from\"@mui/material/CircularProgress\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var crypto=require(\"crypto\");var blockchaintx=\"\";function InvoiceForm(props){var axiosInstance=useAxiosPrivate();var _useState=useState({type:\"Rechnung\",description:\"\",blockchainID:blockchaintx,issue_date:\"\",invoice_text:\"\",currency:\"\",transaction:\"\",invoiceItem:[],priceTotal:\"\",transport_costs:\"\"}),_useState2=_slicedToArray(_useState,2),invoiceFields=_useState2[0],setInvoiceFields=_useState2[1];var _useState3=useState([{product:\"\",amount:\"\",unit:\"\",price:\"\"}]),_useState4=_slicedToArray(_useState3,2),invoiceItemFields=_useState4[0],setInvoiceItemFields=_useState4[1];var _useParams=useParams(),transactionId=_useParams.transactionId;// -- Loading Backdrop --\nvar _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),openBackdrop=_React$useState2[0],setOpenBackdrop=_React$useState2[1];var handleCloseBackdrop=function handleCloseBackdrop(){setOpenBackdrop(false);};var handleToggleBackdrop=function handleToggleBackdrop(){setOpenBackdrop(!openBackdrop);};// Eingabe handlen\nfunction handleItemChange(index,event){var values=_toConsumableArray(invoiceItemFields);values[index][event.target.name]=event.target.value;setInvoiceItemFields(values);invoiceFields.invoiceItem=invoiceItemFields;setInvoiceFields(_objectSpread(_objectSpread({},invoiceFields),{},{transaction:transactionId}));}// Abschicken\nfunction handleSubmit(_x){return _handleSubmit.apply(this,arguments);}// Rechnungsposten hinzufügen\nfunction _handleSubmit(){_handleSubmit=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var _props$transactionDat;var forms,crypto,total;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:// Check Formular Validierung\nforms=document.getElementById(\"invoiceForm\");if(!(forms.checkValidity()==false)){_context.next=4;break;}console.log(\"Formular Eingabe inkorrekt.\");return _context.abrupt(\"return\");case 4:handleToggleBackdrop();crypto=require(\"crypto\");total=calculatePriceTotal();//Blockchain Transaktion\ncreateRechnung(total.toString(),(_props$transactionDat=props.transactionData)===null||_props$transactionDat===void 0?void 0:_props$transactionDat.partnership.partner.publickey,invoiceFields.currency,invoiceFields.issue_date,crypto.createHash(\"sha512\").update(invoiceItemFields).digest(\"hex\"),invoiceFields.transport_costs).then(function(tx){console.log(\"Transaktion erfolgreich: \"+tx);blockchaintx=tx;//Übermittel und anlegen der Rechnung\naxiosInstance.post(\"/invoice/\",{blockchain_id:tx-1,//Blockchain RechnungsID wird gespeichert\ncurrency:invoiceFields.currency,description:invoiceFields.description,invoiceItem:invoiceFields.invoiceItem,invoice_text:invoiceFields.invoice_text,issue_date:invoiceFields.issue_date,priceTotal:invoiceFields.priceTotal,transaction:invoiceFields.transaction,transport_costs:invoiceFields.transport_costs,type:invoiceFields.type}).then(function(res){console.log(\"Rechnung erfolgreich hochgeladen.\");props.setNewDocument(!props.newDocument);props.setSnackbarSuccess(true);props.setSnackbarMessage(\"Rechnung erfolgreich hochgeladen.\");handleCloseBackdrop();props.handleOpenSnackbar();props.setNewDocument(!props.newDocument);props.toggleAddDocumentModal();}).catch(function(error){console.error(\"There was an error!\",error);props.setSnackbarSuccess(false);props.setSnackbarMessage(\"Fehler beim hochladen der Rechnung.\");handleCloseBackdrop();props.handleOpenSnackbar();props.toggleAddDocumentModal();});}).catch(function(err){console.log(\"Transaktion fehlgeschlagen: \"+\"  \"+err);props.setSnackbarSuccess(false);props.setSnackbarMessage(\"Fehler bei der Verarbeitung der Rechnung.\");handleCloseBackdrop();props.handleOpenSnackbar();props.toggleAddDocumentModal();});case 8:case\"end\":return _context.stop();}}},_callee);}));return _handleSubmit.apply(this,arguments);}function handleAddFields(event){event.preventDefault();setInvoiceItemFields([].concat(_toConsumableArray(invoiceItemFields),[{product:\"\",amount:\"\",unit:\"\",price:\"\"}]));}// Rechnungsposten entfernen\nfunction handleRemoveFields(event,index){event.preventDefault();var values=_toConsumableArray(invoiceItemFields);// ALT:\n// values.splice(\n//   values.findIndex((value) => value.index === index),\n//   1\n// );\nvalues.pop();setInvoiceItemFields(values);}function calculatePriceTotal(){var items=invoiceItemFields;var total=0;for(var i=0;i<items.length;i++){total+=items[i].amount*items[i].price;}setInvoiceFields(_objectSpread(_objectSpread({},items),{},{priceTotal:total}));return total;}return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(MDBContainer,{children:/*#__PURE__*/_jsxs(\"form\",{id:\"invoiceForm\",onSubmit:function onSubmit(e){return e.preventDefault();},children:[/*#__PURE__*/_jsxs(MDBRow,{children:[/*#__PURE__*/_jsx(MDBCol,{children:/*#__PURE__*/_jsx(MDBInput,{className:\"mb-4\",name:\"issue_date\",id:\"issue_date\",label:\"Rechnungsdatum\",type:\"date\",required:true,onChange:function onChange(e){return setInvoiceFields(_objectSpread(_objectSpread({},invoiceFields),{},{issue_date:e.target.value}));}})}),/*#__PURE__*/_jsx(MDBCol,{children:/*#__PURE__*/_jsx(MDBInput,{className:\"mb-4\",name:\"currency\",value:invoiceFields.currency,id:\"currency\",label:\"W\\xE4hrung\",type:\"text\",required:true,onChange:function onChange(e){return setInvoiceFields(_objectSpread(_objectSpread({},invoiceFields),{},{currency:e.target.value}));}})}),/*#__PURE__*/_jsx(MDBCol,{children:/*#__PURE__*/_jsx(MDBInput,{className:\"mb-4\",name:\"transport_costs\",id:\"transport_costs\",label:\"Lieferkosten\",type:\"number\",required:true,onChange:function onChange(e){return setInvoiceFields(_objectSpread(_objectSpread({},invoiceFields),{},{transport_costs:e.target.value}));}})})]}),/*#__PURE__*/_jsx(MDBInput,{wrapperClass:\"mb-4\",textarea:true,name:\"description\",id:\"description\",rows:3,label:\"Beschreibung\",required:true,onChange:function onChange(e){return setInvoiceFields(_objectSpread(_objectSpread({},invoiceFields),{},{description:e.target.value}));}}),/*#__PURE__*/_jsx(\"hr\",{}),invoiceItemFields.map(function(inputField,index){return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"h6\",{children:[\"Rechnungsposten \",index+1]}),/*#__PURE__*/_jsx(MDBInput,{className:\"mb-4\",name:\"product\",label:\"Produktname\",type:\"text\",value:inputField.product,required:true,onChange:function onChange(event){return handleItemChange(index,event);}}),/*#__PURE__*/_jsxs(MDBRow,{children:[/*#__PURE__*/_jsx(MDBCol,{children:/*#__PURE__*/_jsx(MDBInput,{className:\"mb-4\",name:\"amount\",label:\"Anzahl\",type:\"number\",value:inputField.amount,required:true,onChange:function onChange(event){return handleItemChange(index,event);}})}),/*#__PURE__*/_jsx(MDBCol,{children:/*#__PURE__*/_jsx(MDBInput,{className:\"mb-4\",name:\"unit\",label:\"Einheit\",type:\"text\",value:inputField.unit,required:true,onChange:function onChange(event){return handleItemChange(index,event);}})}),/*#__PURE__*/_jsx(MDBCol,{children:/*#__PURE__*/_jsx(MDBInput,{className:\"mb-4\",name:\"price\",label:\"Preis pro Enheit\",type:\"number\",value:inputField.price,required:true,onChange:function onChange(event){return handleItemChange(index,event);}})}),/*#__PURE__*/_jsx(MDBCol,{children:/*#__PURE__*/_jsxs(MDBBadge,{className:\"mt-2 me-4 float-end\",color:\"primary\",children:[\"Betrag : \",inputField.amount*inputField.price,\" \",invoiceFields.invoiceCurrency]})})]})]},index);}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(MDBBtn,{className:\"me-3 mb-3\",color:\"success\",onClick:handleAddFields,children:[/*#__PURE__*/_jsx(MDBIcon,{size:\"lg\",className:\"me-2\",fas:true,icon:\"plus\"}),\"Rechnungsposten hinzuf\\xFCgen\"]}),invoiceItemFields.length>1&&/*#__PURE__*/_jsxs(MDBBtn,{className:\"me-3 mb-3\",color:\"danger\",onClick:handleRemoveFields,children:[/*#__PURE__*/_jsx(MDBIcon,{size:\"lg\",className:\"me-2\",fas:true,icon:\"minus\"}),\"Rechnungsposten entfernen\"]}),/*#__PURE__*/_jsxs(MDBBtn,{type:\"submit\",className:\"float-end\",color:\"primary\",onClick:handleSubmit,children:[/*#__PURE__*/_jsx(MDBIcon,{size:\"lg\",className:\"me-2\",fas:true,icon:\"paper-plane\"}),\"Abschicken\"]})]})}),/*#__PURE__*/_jsx(Backdrop,{sx:{color:\"#fff\",zIndex:function zIndex(theme){return theme.zIndex.drawer+1;}},open:openBackdrop,onClick:handleCloseBackdrop,children:/*#__PURE__*/_jsx(CircularProgress,{color:\"inherit\"})})]});}export default InvoiceForm;","map":{"version":3,"sources":["/Users/stephan/Dropbox/Entwicklung/webdev/projektstudium/client/src/components/Documents/InvoiceForm.jsx"],"names":["React","useState","useEffect","isValidElement","MDBContainer","MDBRow","MDBCol","MDBInput","MDBBtn","MDBBadge","MDBIcon","init","createRechnung","createZollanmeldung","useParams","LZString","useAxiosPrivate","Backdrop","CircularProgress","crypto","require","blockchaintx","InvoiceForm","props","axiosInstance","type","description","blockchainID","issue_date","invoice_text","currency","transaction","invoiceItem","priceTotal","transport_costs","invoiceFields","setInvoiceFields","product","amount","unit","price","invoiceItemFields","setInvoiceItemFields","transactionId","openBackdrop","setOpenBackdrop","handleCloseBackdrop","handleToggleBackdrop","handleItemChange","index","event","values","target","name","value","handleSubmit","e","forms","document","getElementById","checkValidity","console","log","total","calculatePriceTotal","toString","transactionData","partnership","partner","publickey","createHash","update","digest","then","tx","post","blockchain_id","res","setNewDocument","newDocument","setSnackbarSuccess","setSnackbarMessage","handleOpenSnackbar","toggleAddDocumentModal","catch","error","err","handleAddFields","preventDefault","handleRemoveFields","pop","items","i","length","map","inputField","invoiceCurrency","color","zIndex","theme","drawer"],"mappings":"mvBAAA,MAAOA,CAAAA,KAAP,EAAgBC,QAAhB,CAA0BC,SAA1B,CAAqCC,cAArC,KAA2D,OAA3D,CACA,OACEC,YADF,CAEEC,MAFF,CAGEC,MAHF,CAIEC,QAJF,CAKEC,MALF,CAMEC,QANF,CAOEC,OAPF,KAQO,kBARP,CASA,OAASC,IAAT,CAAeC,cAAf,CAA+BC,mBAA/B,KAA0D,kBAA1D,CACA,OAASC,SAAT,KAA0B,kBAA1B,CACA,MAAe,UAAf,CACA,MAAOC,CAAAA,QAAP,KAAqB,WAArB,CACA,MAAOC,CAAAA,eAAP,KAA4B,6BAA5B,CACA,MAAOC,CAAAA,QAAP,KAAqB,wBAArB,CACA,MAAOC,CAAAA,gBAAP,KAA6B,gCAA7B,C,6IAEA,GAAIC,CAAAA,MAAM,CAAGC,OAAO,CAAC,QAAD,CAApB,CACA,GAAIC,CAAAA,YAAY,CAAG,EAAnB,CACA,QAASC,CAAAA,WAAT,CAAqBC,KAArB,CAA4B,CAC1B,GAAMC,CAAAA,aAAa,CAAGR,eAAe,EAArC,CAEA,cAA0Cf,QAAQ,CAAC,CACjDwB,IAAI,CAAE,UAD2C,CAEjDC,WAAW,CAAE,EAFoC,CAGjDC,YAAY,CAAEN,YAHmC,CAIjDO,UAAU,CAAE,EAJqC,CAKjDC,YAAY,CAAE,EALmC,CAMjDC,QAAQ,CAAE,EANuC,CAOjDC,WAAW,CAAE,EAPoC,CAQjDC,WAAW,CAAE,EARoC,CASjDC,UAAU,CAAE,EATqC,CAUjDC,eAAe,CAAE,EAVgC,CAAD,CAAlD,wCAAOC,aAAP,eAAsBC,gBAAtB,eAaA,eAAkDnC,QAAQ,CAAC,CACzD,CACEoC,OAAO,CAAE,EADX,CAEEC,MAAM,CAAE,EAFV,CAGEC,IAAI,CAAE,EAHR,CAIEC,KAAK,CAAE,EAJT,CADyD,CAAD,CAA1D,yCAAOC,iBAAP,eAA0BC,oBAA1B,eAQA,eAA0B5B,SAAS,EAAnC,CAAQ6B,aAAR,YAAQA,aAAR,CAEA;AACA,oBAAwC3C,KAAK,CAACC,QAAN,CAAe,KAAf,CAAxC,oDAAO2C,YAAP,qBAAqBC,eAArB,qBACA,GAAMC,CAAAA,mBAAmB,CAAG,QAAtBA,CAAAA,mBAAsB,EAAM,CAChCD,eAAe,CAAC,KAAD,CAAf,CACD,CAFD,CAGA,GAAME,CAAAA,oBAAoB,CAAG,QAAvBA,CAAAA,oBAAuB,EAAM,CACjCF,eAAe,CAAC,CAACD,YAAF,CAAf,CACD,CAFD,CAIA;AACA,QAASI,CAAAA,gBAAT,CAA0BC,KAA1B,CAAiCC,KAAjC,CAAwC,CACtC,GAAMC,CAAAA,MAAM,oBAAOV,iBAAP,CAAZ,CACAU,MAAM,CAACF,KAAD,CAAN,CAAcC,KAAK,CAACE,MAAN,CAAaC,IAA3B,EAAmCH,KAAK,CAACE,MAAN,CAAaE,KAAhD,CACAZ,oBAAoB,CAACS,MAAD,CAApB,CAEAhB,aAAa,CAACH,WAAd,CAA4BS,iBAA5B,CAEAL,gBAAgB,gCAAMD,aAAN,MAAqBJ,WAAW,CAAEY,aAAlC,GAAhB,CACD,CAED;AA9C0B,QA+CXY,CAAAA,YA/CW,iDAkH1B;AAlH0B,+FA+C1B,iBAA4BC,CAA5B,mKACE;AACIC,KAFN,CAEcC,QAAQ,CAACC,cAAT,CAAwB,aAAxB,CAFd,MAGMF,KAAK,CAACG,aAAN,IAAyB,KAH/B,0BAIIC,OAAO,CAACC,GAAR,CAAY,6BAAZ,EAJJ,wCAQEf,oBAAoB,GAChB5B,MATN,CASeC,OAAO,CAAC,QAAD,CATtB,CAUM2C,KAVN,CAUcC,mBAAmB,EAVjC,CAYE;AACApD,cAAc,CACZmD,KAAK,CAACE,QAAN,EADY,wBAEZ1C,KAAK,CAAC2C,eAFM,gDAEZ,sBAAuBC,WAAvB,CAAmCC,OAAnC,CAA2CC,SAF/B,CAGZlC,aAAa,CAACL,QAHF,CAIZK,aAAa,CAACP,UAJF,CAKZT,MAAM,CAACmD,UAAP,CAAkB,QAAlB,EAA4BC,MAA5B,CAAmC9B,iBAAnC,EAAsD+B,MAAtD,CAA6D,KAA7D,CALY,CAMZrC,aAAa,CAACD,eANF,CAAd,CAQGuC,IARH,CAQQ,SAACC,EAAD,CAAQ,CACZb,OAAO,CAACC,GAAR,CAAY,4BAA8BY,EAA1C,EACArD,YAAY,CAAGqD,EAAf,CACA;AACAlD,aAAa,CACVmD,IADH,CACQ,WADR,CACqB,CACjBC,aAAa,CAAEF,EAAE,CAAG,CADH,CACM;AACvB5C,QAAQ,CAAEK,aAAa,CAACL,QAFP,CAGjBJ,WAAW,CAAES,aAAa,CAACT,WAHV,CAIjBM,WAAW,CAAEG,aAAa,CAACH,WAJV,CAKjBH,YAAY,CAAEM,aAAa,CAACN,YALX,CAMjBD,UAAU,CAAEO,aAAa,CAACP,UANT,CAOjBK,UAAU,CAAEE,aAAa,CAACF,UAPT,CAQjBF,WAAW,CAAEI,aAAa,CAACJ,WARV,CASjBG,eAAe,CAAEC,aAAa,CAACD,eATd,CAUjBT,IAAI,CAAEU,aAAa,CAACV,IAVH,CADrB,EAaGgD,IAbH,CAaQ,SAACI,GAAD,CAAS,CACbhB,OAAO,CAACC,GAAR,CAAY,mCAAZ,EACAvC,KAAK,CAACuD,cAAN,CAAqB,CAACvD,KAAK,CAACwD,WAA5B,EACAxD,KAAK,CAACyD,kBAAN,CAAyB,IAAzB,EACAzD,KAAK,CAAC0D,kBAAN,CAAyB,mCAAzB,EACAnC,mBAAmB,GACnBvB,KAAK,CAAC2D,kBAAN,GACA3D,KAAK,CAACuD,cAAN,CAAqB,CAACvD,KAAK,CAACwD,WAA5B,EACAxD,KAAK,CAAC4D,sBAAN,GACD,CAtBH,EAuBGC,KAvBH,CAuBS,SAACC,KAAD,CAAW,CAChBxB,OAAO,CAACwB,KAAR,CAAc,qBAAd,CAAqCA,KAArC,EACA9D,KAAK,CAACyD,kBAAN,CAAyB,KAAzB,EACAzD,KAAK,CAAC0D,kBAAN,CAAyB,qCAAzB,EACAnC,mBAAmB,GACnBvB,KAAK,CAAC2D,kBAAN,GACA3D,KAAK,CAAC4D,sBAAN,GACD,CA9BH,EA+BD,CA3CH,EA4CGC,KA5CH,CA4CS,SAACE,GAAD,CAAS,CACdzB,OAAO,CAACC,GAAR,CAAY,+BAAiC,IAAjC,CAAwCwB,GAApD,EACA/D,KAAK,CAACyD,kBAAN,CAAyB,KAAzB,EACAzD,KAAK,CAAC0D,kBAAN,CAAyB,2CAAzB,EACAnC,mBAAmB,GACnBvB,KAAK,CAAC2D,kBAAN,GACA3D,KAAK,CAAC4D,sBAAN,GACD,CAnDH,EAbF,sDA/C0B,+CAmH1B,QAASI,CAAAA,eAAT,CAAyBrC,KAAzB,CAAgC,CAC9BA,KAAK,CAACsC,cAAN,GACA9C,oBAAoB,8BACfD,iBADe,GAElB,CACEJ,OAAO,CAAE,EADX,CAEEC,MAAM,CAAE,EAFV,CAGEC,IAAI,CAAE,EAHR,CAIEC,KAAK,CAAE,EAJT,CAFkB,GAApB,CASD,CAED;AACA,QAASiD,CAAAA,kBAAT,CAA4BvC,KAA5B,CAAmCD,KAAnC,CAA0C,CACxCC,KAAK,CAACsC,cAAN,GACA,GAAMrC,CAAAA,MAAM,oBAAOV,iBAAP,CAAZ,CAEA;AACA;AACA;AACA;AACA;AAEAU,MAAM,CAACuC,GAAP,GACAhD,oBAAoB,CAACS,MAAD,CAApB,CACD,CAED,QAASa,CAAAA,mBAAT,EAA+B,CAC7B,GAAM2B,CAAAA,KAAK,CAAGlD,iBAAd,CACA,GAAIsB,CAAAA,KAAK,CAAG,CAAZ,CAEA,IAAK,GAAI6B,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGD,KAAK,CAACE,MAA1B,CAAkCD,CAAC,EAAnC,CAAuC,CACrC7B,KAAK,EAAI4B,KAAK,CAACC,CAAD,CAAL,CAAStD,MAAT,CAAkBqD,KAAK,CAACC,CAAD,CAAL,CAASpD,KAApC,CACD,CACDJ,gBAAgB,gCAAMuD,KAAN,MAAa1D,UAAU,CAAE8B,KAAzB,GAAhB,CAEA,MAAOA,CAAAA,KAAP,CACD,CAED,mBACE,wCACE,KAAC,YAAD,wBACE,cAAM,EAAE,CAAC,aAAT,CAAuB,QAAQ,CAAE,kBAACP,CAAD,QAAOA,CAAAA,CAAC,CAACgC,cAAF,EAAP,EAAjC,wBACE,MAAC,MAAD,yBACE,KAAC,MAAD,wBACE,KAAC,QAAD,EACE,SAAS,CAAC,MADZ,CAEE,IAAI,CAAC,YAFP,CAGE,EAAE,CAAC,YAHL,CAIE,KAAK,CAAC,gBAJR,CAKE,IAAI,CAAC,MALP,CAME,QAAQ,KANV,CAOE,QAAQ,CAAE,kBAAChC,CAAD,QACRpB,CAAAA,gBAAgB,gCACXD,aADW,MAEdP,UAAU,CAAE4B,CAAC,CAACJ,MAAF,CAASE,KAFP,GADR,EAPZ,EADF,EADF,cAiBE,KAAC,MAAD,wBACE,KAAC,QAAD,EACE,SAAS,CAAC,MADZ,CAEE,IAAI,CAAC,UAFP,CAGE,KAAK,CAAEnB,aAAa,CAACL,QAHvB,CAIE,EAAE,CAAC,UAJL,CAKE,KAAK,CAAC,YALR,CAME,IAAI,CAAC,MANP,CAOE,QAAQ,KAPV,CAQE,QAAQ,CAAE,kBAAC0B,CAAD,QACRpB,CAAAA,gBAAgB,gCACXD,aADW,MAEdL,QAAQ,CAAE0B,CAAC,CAACJ,MAAF,CAASE,KAFL,GADR,EARZ,EADF,EAjBF,cAkCE,KAAC,MAAD,wBACE,KAAC,QAAD,EACE,SAAS,CAAC,MADZ,CAEE,IAAI,CAAC,iBAFP,CAGE,EAAE,CAAC,iBAHL,CAIE,KAAK,CAAC,cAJR,CAKE,IAAI,CAAC,QALP,CAME,QAAQ,KANV,CAOE,QAAQ,CAAE,kBAACE,CAAD,QACRpB,CAAAA,gBAAgB,gCACXD,aADW,MAEdD,eAAe,CAAEsB,CAAC,CAACJ,MAAF,CAASE,KAFZ,GADR,EAPZ,EADF,EAlCF,GADF,cAoDE,KAAC,QAAD,EACE,YAAY,CAAC,MADf,CAEE,QAAQ,KAFV,CAGE,IAAI,CAAC,aAHP,CAIE,EAAE,CAAC,aAJL,CAKE,IAAI,CAAE,CALR,CAME,KAAK,CAAC,cANR,CAOE,QAAQ,KAPV,CAQE,QAAQ,CAAE,kBAACE,CAAD,QACRpB,CAAAA,gBAAgB,gCACXD,aADW,MAEdT,WAAW,CAAE8B,CAAC,CAACJ,MAAF,CAASE,KAFR,GADR,EARZ,EApDF,cAmEE,aAnEF,CAqEGb,iBAAiB,CAACqD,GAAlB,CAAsB,SAACC,UAAD,CAAa9C,KAAb,qBACrB,oCACE,yCAAqBA,KAAK,CAAG,CAA7B,GADF,cAEE,KAAC,QAAD,EACE,SAAS,CAAC,MADZ,CAEE,IAAI,CAAC,SAFP,CAGE,KAAK,CAAC,aAHR,CAIE,IAAI,CAAC,MAJP,CAKE,KAAK,CAAE8C,UAAU,CAAC1D,OALpB,CAME,QAAQ,KANV,CAOE,QAAQ,CAAE,kBAACa,KAAD,QAAWF,CAAAA,gBAAgB,CAACC,KAAD,CAAQC,KAAR,CAA3B,EAPZ,EAFF,cAWE,MAAC,MAAD,yBACE,KAAC,MAAD,wBACE,KAAC,QAAD,EACE,SAAS,CAAC,MADZ,CAEE,IAAI,CAAC,QAFP,CAGE,KAAK,CAAC,QAHR,CAIE,IAAI,CAAC,QAJP,CAKE,KAAK,CAAE6C,UAAU,CAACzD,MALpB,CAME,QAAQ,KANV,CAOE,QAAQ,CAAE,kBAACY,KAAD,QAAWF,CAAAA,gBAAgB,CAACC,KAAD,CAAQC,KAAR,CAA3B,EAPZ,EADF,EADF,cAYE,KAAC,MAAD,wBACE,KAAC,QAAD,EACE,SAAS,CAAC,MADZ,CAEE,IAAI,CAAC,MAFP,CAGE,KAAK,CAAC,SAHR,CAIE,IAAI,CAAC,MAJP,CAKE,KAAK,CAAE6C,UAAU,CAACxD,IALpB,CAME,QAAQ,KANV,CAOE,QAAQ,CAAE,kBAACW,KAAD,QAAWF,CAAAA,gBAAgB,CAACC,KAAD,CAAQC,KAAR,CAA3B,EAPZ,EADF,EAZF,cAuBE,KAAC,MAAD,wBACE,KAAC,QAAD,EACE,SAAS,CAAC,MADZ,CAEE,IAAI,CAAC,OAFP,CAGE,KAAK,CAAC,kBAHR,CAIE,IAAI,CAAC,QAJP,CAKE,KAAK,CAAE6C,UAAU,CAACvD,KALpB,CAME,QAAQ,KANV,CAOE,QAAQ,CAAE,kBAACU,KAAD,QAAWF,CAAAA,gBAAgB,CAACC,KAAD,CAAQC,KAAR,CAA3B,EAPZ,EADF,EAvBF,cAkCE,KAAC,MAAD,wBACE,MAAC,QAAD,EAAU,SAAS,CAAC,qBAApB,CAA0C,KAAK,CAAC,SAAhD,uBACY6C,UAAU,CAACzD,MAAX,CAAoByD,UAAU,CAACvD,KAD3C,CACkD,GADlD,CAEGL,aAAa,CAAC6D,eAFjB,GADF,EAlCF,GAXF,GAAU/C,KAAV,CADqB,EAAtB,CArEH,cA4HE,aA5HF,cA8HE,MAAC,MAAD,EACE,SAAS,CAAC,WADZ,CAEE,KAAK,CAAC,SAFR,CAGE,OAAO,CAAEsC,eAHX,wBAKE,KAAC,OAAD,EAAS,IAAI,CAAC,IAAd,CAAmB,SAAS,CAAC,MAA7B,CAAoC,GAAG,KAAvC,CAAwC,IAAI,CAAC,MAA7C,EALF,mCA9HF,CAsIG9C,iBAAiB,CAACoD,MAAlB,CAA2B,CAA3B,eACC,MAAC,MAAD,EACE,SAAS,CAAC,WADZ,CAEE,KAAK,CAAC,QAFR,CAGE,OAAO,CAAEJ,kBAHX,wBAKE,KAAC,OAAD,EAAS,IAAI,CAAC,IAAd,CAAmB,SAAS,CAAC,MAA7B,CAAoC,GAAG,KAAvC,CAAwC,IAAI,CAAC,OAA7C,EALF,+BAvIJ,cAiJE,MAAC,MAAD,EACE,IAAI,CAAC,QADP,CAEE,SAAS,CAAC,WAFZ,CAGE,KAAK,CAAC,SAHR,CAIE,OAAO,CAAElC,YAJX,wBAME,KAAC,OAAD,EAAS,IAAI,CAAC,IAAd,CAAmB,SAAS,CAAC,MAA7B,CAAoC,GAAG,KAAvC,CAAwC,IAAI,CAAC,aAA7C,EANF,gBAjJF,GADF,EADF,cAgKE,KAAC,QAAD,EACE,EAAE,CAAE,CAAE0C,KAAK,CAAE,MAAT,CAAiBC,MAAM,CAAE,gBAACC,KAAD,QAAWA,CAAAA,KAAK,CAACD,MAAN,CAAaE,MAAb,CAAsB,CAAjC,EAAzB,CADN,CAEE,IAAI,CAAExD,YAFR,CAGE,OAAO,CAAEE,mBAHX,uBAKE,KAAC,gBAAD,EAAkB,KAAK,CAAC,SAAxB,EALF,EAhKF,GADF,CA0KD,CAED,cAAexB,CAAAA,WAAf","sourcesContent":["import React, { useState, useEffect, isValidElement } from \"react\";\nimport {\n  MDBContainer,\n  MDBRow,\n  MDBCol,\n  MDBInput,\n  MDBBtn,\n  MDBBadge,\n  MDBIcon,\n} from \"mdb-react-ui-kit\";\nimport { init, createRechnung, createZollanmeldung } from \"../../Web3Client\";\nimport { useParams } from \"react-router-dom\";\nimport {} from \"json2csv\";\nimport LZString from \"lz-string\";\nimport useAxiosPrivate from \"../../hooks/useAxiosPrivate\";\nimport Backdrop from \"@mui/material/Backdrop\";\nimport CircularProgress from \"@mui/material/CircularProgress\";\n\nvar crypto = require(\"crypto\");\nvar blockchaintx = \"\";\nfunction InvoiceForm(props) {\n  const axiosInstance = useAxiosPrivate();\n\n  const [invoiceFields, setInvoiceFields] = useState({\n    type: \"Rechnung\",\n    description: \"\",\n    blockchainID: blockchaintx,\n    issue_date: \"\",\n    invoice_text: \"\",\n    currency: \"\",\n    transaction: \"\",\n    invoiceItem: [],\n    priceTotal: \"\",\n    transport_costs: \"\",\n  });\n\n  const [invoiceItemFields, setInvoiceItemFields] = useState([\n    {\n      product: \"\",\n      amount: \"\",\n      unit: \"\",\n      price: \"\",\n    },\n  ]);\n  const { transactionId } = useParams();\n\n  // -- Loading Backdrop --\n  const [openBackdrop, setOpenBackdrop] = React.useState(false);\n  const handleCloseBackdrop = () => {\n    setOpenBackdrop(false);\n  };\n  const handleToggleBackdrop = () => {\n    setOpenBackdrop(!openBackdrop);\n  };\n\n  // Eingabe handlen\n  function handleItemChange(index, event) {\n    const values = [...invoiceItemFields];\n    values[index][event.target.name] = event.target.value;\n    setInvoiceItemFields(values);\n\n    invoiceFields.invoiceItem = invoiceItemFields;\n\n    setInvoiceFields({ ...invoiceFields, transaction: transactionId });\n  }\n\n  // Abschicken\n  async function handleSubmit(e) {\n    // Check Formular Validierung\n    var forms = document.getElementById(\"invoiceForm\");\n    if (forms.checkValidity() == false) {\n      console.log(\"Formular Eingabe inkorrekt.\");\n      return;\n    }\n\n    handleToggleBackdrop();\n    var crypto = require(\"crypto\");\n    let total = calculatePriceTotal();\n\n    //Blockchain Transaktion\n    createRechnung(\n      total.toString(),\n      props.transactionData?.partnership.partner.publickey,\n      invoiceFields.currency,\n      invoiceFields.issue_date,\n      crypto.createHash(\"sha512\").update(invoiceItemFields).digest(\"hex\"),\n      invoiceFields.transport_costs\n    )\n      .then((tx) => {\n        console.log(\"Transaktion erfolgreich: \" + tx);\n        blockchaintx = tx;\n        //Übermittel und anlegen der Rechnung\n        axiosInstance\n          .post(\"/invoice/\", {\n            blockchain_id: tx - 1, //Blockchain RechnungsID wird gespeichert\n            currency: invoiceFields.currency,\n            description: invoiceFields.description,\n            invoiceItem: invoiceFields.invoiceItem,\n            invoice_text: invoiceFields.invoice_text,\n            issue_date: invoiceFields.issue_date,\n            priceTotal: invoiceFields.priceTotal,\n            transaction: invoiceFields.transaction,\n            transport_costs: invoiceFields.transport_costs,\n            type: invoiceFields.type,\n          })\n          .then((res) => {\n            console.log(\"Rechnung erfolgreich hochgeladen.\");\n            props.setNewDocument(!props.newDocument);\n            props.setSnackbarSuccess(true);\n            props.setSnackbarMessage(\"Rechnung erfolgreich hochgeladen.\");\n            handleCloseBackdrop();\n            props.handleOpenSnackbar();\n            props.setNewDocument(!props.newDocument);\n            props.toggleAddDocumentModal();\n          })\n          .catch((error) => {\n            console.error(\"There was an error!\", error);\n            props.setSnackbarSuccess(false);\n            props.setSnackbarMessage(\"Fehler beim hochladen der Rechnung.\");\n            handleCloseBackdrop();\n            props.handleOpenSnackbar();\n            props.toggleAddDocumentModal();\n          });\n      })\n      .catch((err) => {\n        console.log(\"Transaktion fehlgeschlagen: \" + \"  \" + err);\n        props.setSnackbarSuccess(false);\n        props.setSnackbarMessage(\"Fehler bei der Verarbeitung der Rechnung.\");\n        handleCloseBackdrop();\n        props.handleOpenSnackbar();\n        props.toggleAddDocumentModal();\n      });\n  }\n\n  // Rechnungsposten hinzufügen\n  function handleAddFields(event) {\n    event.preventDefault();\n    setInvoiceItemFields([\n      ...invoiceItemFields,\n      {\n        product: \"\",\n        amount: \"\",\n        unit: \"\",\n        price: \"\",\n      },\n    ]);\n  }\n\n  // Rechnungsposten entfernen\n  function handleRemoveFields(event, index) {\n    event.preventDefault();\n    const values = [...invoiceItemFields];\n\n    // ALT:\n    // values.splice(\n    //   values.findIndex((value) => value.index === index),\n    //   1\n    // );\n\n    values.pop();\n    setInvoiceItemFields(values);\n  }\n\n  function calculatePriceTotal() {\n    const items = invoiceItemFields;\n    let total = 0;\n\n    for (let i = 0; i < items.length; i++) {\n      total += items[i].amount * items[i].price;\n    }\n    setInvoiceFields({ ...items, priceTotal: total });\n\n    return total;\n  }\n\n  return (\n    <>\n      <MDBContainer>\n        <form id=\"invoiceForm\" onSubmit={(e) => e.preventDefault()}>\n          <MDBRow>\n            <MDBCol>\n              <MDBInput\n                className=\"mb-4\"\n                name=\"issue_date\"\n                id=\"issue_date\"\n                label=\"Rechnungsdatum\"\n                type=\"date\"\n                required\n                onChange={(e) =>\n                  setInvoiceFields({\n                    ...invoiceFields,\n                    issue_date: e.target.value,\n                  })\n                }\n              />\n            </MDBCol>\n            <MDBCol>\n              <MDBInput\n                className=\"mb-4\"\n                name=\"currency\"\n                value={invoiceFields.currency}\n                id=\"currency\"\n                label=\"Währung\"\n                type=\"text\"\n                required\n                onChange={(e) =>\n                  setInvoiceFields({\n                    ...invoiceFields,\n                    currency: e.target.value,\n                  })\n                }\n              />\n            </MDBCol>\n            <MDBCol>\n              <MDBInput\n                className=\"mb-4\"\n                name=\"transport_costs\"\n                id=\"transport_costs\"\n                label=\"Lieferkosten\"\n                type=\"number\"\n                required\n                onChange={(e) =>\n                  setInvoiceFields({\n                    ...invoiceFields,\n                    transport_costs: e.target.value,\n                  })\n                }\n              />\n            </MDBCol>\n          </MDBRow>\n          <MDBInput\n            wrapperClass=\"mb-4\"\n            textarea\n            name=\"description\"\n            id=\"description\"\n            rows={3}\n            label=\"Beschreibung\"\n            required\n            onChange={(e) =>\n              setInvoiceFields({\n                ...invoiceFields,\n                description: e.target.value,\n              })\n            }\n          />\n          <hr />\n\n          {invoiceItemFields.map((inputField, index) => (\n            <div key={index}>\n              <h6>Rechnungsposten {index + 1}</h6>\n              <MDBInput\n                className=\"mb-4\"\n                name=\"product\"\n                label=\"Produktname\"\n                type=\"text\"\n                value={inputField.product}\n                required\n                onChange={(event) => handleItemChange(index, event)}\n              />\n              <MDBRow>\n                <MDBCol>\n                  <MDBInput\n                    className=\"mb-4\"\n                    name=\"amount\"\n                    label=\"Anzahl\"\n                    type=\"number\"\n                    value={inputField.amount}\n                    required\n                    onChange={(event) => handleItemChange(index, event)}\n                  />\n                </MDBCol>\n                <MDBCol>\n                  <MDBInput\n                    className=\"mb-4\"\n                    name=\"unit\"\n                    label=\"Einheit\"\n                    type=\"text\"\n                    value={inputField.unit}\n                    required\n                    onChange={(event) => handleItemChange(index, event)}\n                  />\n                </MDBCol>\n                <MDBCol>\n                  <MDBInput\n                    className=\"mb-4\"\n                    name=\"price\"\n                    label=\"Preis pro Enheit\"\n                    type=\"number\"\n                    value={inputField.price}\n                    required\n                    onChange={(event) => handleItemChange(index, event)}\n                  />\n                </MDBCol>\n                <MDBCol>\n                  <MDBBadge className=\"mt-2 me-4 float-end\" color=\"primary\">\n                    Betrag : {inputField.amount * inputField.price}{\" \"}\n                    {invoiceFields.invoiceCurrency}\n                  </MDBBadge>\n                </MDBCol>\n              </MDBRow>\n            </div>\n          ))}\n          <br />\n\n          <MDBBtn\n            className=\"me-3 mb-3\"\n            color=\"success\"\n            onClick={handleAddFields}\n          >\n            <MDBIcon size=\"lg\" className=\"me-2\" fas icon=\"plus\" />\n            Rechnungsposten hinzufügen\n          </MDBBtn>\n          {invoiceItemFields.length > 1 && (\n            <MDBBtn\n              className=\"me-3 mb-3\"\n              color=\"danger\"\n              onClick={handleRemoveFields}\n            >\n              <MDBIcon size=\"lg\" className=\"me-2\" fas icon=\"minus\" />\n              Rechnungsposten entfernen\n            </MDBBtn>\n          )}\n\n          <MDBBtn\n            type=\"submit\"\n            className=\"float-end\"\n            color=\"primary\"\n            onClick={handleSubmit}\n          >\n            <MDBIcon size=\"lg\" className=\"me-2\" fas icon=\"paper-plane\" />\n            Abschicken\n          </MDBBtn>\n        </form>\n      </MDBContainer>\n\n      {/* Loading Backdrop bei Meta Mask Dialog*/}\n      <Backdrop\n        sx={{ color: \"#fff\", zIndex: (theme) => theme.zIndex.drawer + 1 }}\n        open={openBackdrop}\n        onClick={handleCloseBackdrop}\n      >\n        <CircularProgress color=\"inherit\" />\n      </Backdrop>\n    </>\n  );\n}\n\nexport default InvoiceForm;\n"]},"metadata":{},"sourceType":"module"}