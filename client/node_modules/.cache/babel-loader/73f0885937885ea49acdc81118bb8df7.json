{"ast":null,"code":"import _asyncToGenerator from\"/Users/stephan/Dropbox/Entwicklung/webdev/projektstudium/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/stephan/Dropbox/Entwicklung/webdev/projektstudium/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/Users/stephan/Dropbox/Entwicklung/webdev/projektstudium/client/node_modules/@babel/runtime/regenerator/index.js\";import React,{useState,useEffect}from\"react\";import{MDBContainer,MDBInput,MDBBtn,MDBIcon}from\"mdb-react-ui-kit\";import useAxiosPrivate from\"../../hooks/useAxiosPrivate\";import useAuth from\"../../hooks/useAuth\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";function PartnerForm(props){var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),eori_nr=_useState2[0],setEoriNr=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),companies=_useState4[0],setCompanies=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),requestedCompany=_useState6[0],setrequestedCompany=_useState6[1];var axiosPrivate=useAxiosPrivate();var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),testRerender=_useState8[0],setTestRerender=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),notFound=_useState10[0],setNotFound=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),isCurrentPartnership=_useState12[0],setIsCurrentPartnership=_useState12[1];var _useState13=useState(),_useState14=_slicedToArray(_useState13,2),partnerships=_useState14[0],setPartnerships=_useState14[1];var _useAuth=useAuth(),auth=_useAuth.auth;//useffect Abfragen der Firmemliste\n// DB Call\nuseEffect(function(){axiosPrivate.get(\"partnership/\").then(function(res){setPartnerships(res.data);});},[testRerender]);// EORI Suche\nfunction handleEORISearch(){return _handleEORISearch.apply(this,arguments);}function _handleEORISearch(){_handleEORISearch=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var forms;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:forms=document.getElementById(\"partnerForm\");if(!(forms.checkValidity()==false)){_context.next=3;break;}return _context.abrupt(\"return\");case 3://Leeren wenn neu gesucht wird\nsetCompanies();setNotFound(false);setIsCurrentPartnership(false);_context.next=8;return axiosPrivate.get(\"companies/\".concat(eori_nr,\"/\")).then(function(res){setCompanies(res.data);if(partnerships.some(function(partnerships){return partnerships.partner.eori_nr==res.data.eori_nr;})||auth.eori_nr==res.data.eori_nr){setIsCurrentPartnership(true);}}).catch(function(err){console.log(err);setNotFound(true);});case 8:case\"end\":return _context.stop();}}},_callee);}));return _handleEORISearch.apply(this,arguments);}function handleSubmit(e){e.preventDefault();//firma hinzufügen\nconsole.log(\"Added Partner: \"+companies.eori_nr);axiosPrivate.post(\"/partnership/\",{added_partner:companies.eori_nr}).then(// setTestRerender(true),\n// Reload Partern State\nprops.setNewPartner(!props.newPartner),// Snackbar Alert\nprops.setSnackbarSuccess(true),props.setSnackbarMessage(\"Partneranfrage gesendet.\"),props.handleOpenSnackbar(),// Modal schließen\nprops.toggleShow()).catch(function(error){console.error(\"There was an error!\",error);// Snackbar definieren\nprops.setSnackbarSuccess(false);props.setSnackbarMessage(\"Fehler beim Anfragen der Handelsbeziehung.\");props.handleOpenSnackbar();// Modal schließen\nprops.toggleShow();});//firma als partner hinterlegen\n}return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(MDBContainer,{children:[/*#__PURE__*/_jsxs(\"form\",{id:\"partnerForm\",onSubmit:function onSubmit(e){return e.preventDefault();},children:[/*#__PURE__*/_jsx(MDBInput,{className:\"my-3\",name:\"eori_nr\",label:\"EORI-Nr.\",type:\"number\",required:true,onChange:function onChange(e){return setEoriNr(e.target.value);}}),eori_nr==\"\"?/*#__PURE__*/_jsxs(MDBBtn,{block:true,className:\"mb-4\",type:\"search\",color:\"primary\",disabled:true,onClick:function onClick(e){return handleEORISearch();},children:[/*#__PURE__*/_jsx(MDBIcon,{size:\"lg\",className:\"me-2\",fas:true,icon:\"search\"}),\"Unternehmen suchen\"]}):/*#__PURE__*/_jsxs(MDBBtn,{block:true,className:\"mb-4\",color:\"primary\",type:\"submit\",onClick:function onClick(e){return handleEORISearch();},children:[/*#__PURE__*/_jsx(MDBIcon,{size:\"lg\",className:\"me-2\",fas:true,icon:\"search\"}),\"Unternehmen suchen\"]})]}),notFound&&/*#__PURE__*/_jsx(\"p\",{children:\" EORI-NR nicht gefunden, bitte erneut probieren\"}),(companies===null||companies===void 0?void 0:companies.name)!=undefined&&/*#__PURE__*/_jsxs(\"p\",{children:[\" \",\"Treffer: \",/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(\"b\",{children:[companies===null||companies===void 0?void 0:companies.name,\" \",/*#__PURE__*/_jsx(\"br\",{}),companies===null||companies===void 0?void 0:companies.street,\" \",/*#__PURE__*/_jsx(\"br\",{}),companies===null||companies===void 0?void 0:companies.city_code,\" \",companies===null||companies===void 0?void 0:companies.city,\" \",/*#__PURE__*/_jsx(\"br\",{}),companies===null||companies===void 0?void 0:companies.country_code]})]}),isCurrentPartnership&&/*#__PURE__*/_jsxs(\"p\",{children:[\" \",\"Eine Partnerschaft existiert mit diesem Unternehmen bereits oder es ist ihr eigenes Unternehmen.\"]}),(companies===null||companies===void 0?void 0:companies.name)!=undefined&&isCurrentPartnership==false?/*#__PURE__*/_jsx(MDBBtn,{block:true,className:\"mt-3\",type:\"submit\",onClick:function onClick(e){return handleSubmit(e);},color:\"success\",children:\"Anfrage stellen\"}):null]})});}export default PartnerForm;","map":{"version":3,"sources":["/Users/stephan/Dropbox/Entwicklung/webdev/projektstudium/client/src/components/Partners/PartnerForm.jsx"],"names":["React","useState","useEffect","MDBContainer","MDBInput","MDBBtn","MDBIcon","useAxiosPrivate","useAuth","PartnerForm","props","eori_nr","setEoriNr","companies","setCompanies","requestedCompany","setrequestedCompany","axiosPrivate","testRerender","setTestRerender","notFound","setNotFound","isCurrentPartnership","setIsCurrentPartnership","partnerships","setPartnerships","auth","get","then","res","data","handleEORISearch","forms","document","getElementById","checkValidity","some","partner","catch","err","console","log","handleSubmit","e","preventDefault","post","added_partner","setNewPartner","newPartner","setSnackbarSuccess","setSnackbarMessage","handleOpenSnackbar","toggleShow","error","target","value","name","undefined","street","city_code","city","country_code"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { MDBContainer, MDBInput, MDBBtn, MDBIcon } from \"mdb-react-ui-kit\";\nimport useAxiosPrivate from \"../../hooks/useAxiosPrivate\";\nimport useAuth from \"../../hooks/useAuth\";\n\nfunction PartnerForm(props) {\n  const [eori_nr, setEoriNr] = useState(\"\");\n  const [companies, setCompanies] = useState([]);\n  const [requestedCompany, setrequestedCompany] = useState(\"\");\n  const axiosPrivate = useAxiosPrivate();\n  const [testRerender, setTestRerender] = useState(false);\n  const [notFound, setNotFound] = useState(false);\n  const [isCurrentPartnership, setIsCurrentPartnership] = useState(false);\n  const [partnerships, setPartnerships] = useState();\n  const { auth } = useAuth();\n  //useffect Abfragen der Firmemliste\n\n  // DB Call\n  useEffect(() => {\n    axiosPrivate.get(\"partnership/\").then((res) => {\n      setPartnerships(res.data);\n    });\n  }, [testRerender]);\n\n  // EORI Suche\n  async function handleEORISearch() {\n    var forms = document.getElementById(\"partnerForm\");\n\n    if (forms.checkValidity() == false) {\n      //console.log(\"Formular Eingabe inkorrekt.\");\n      return;\n    }\n\n    //Leeren wenn neu gesucht wird\n    setCompanies();\n    setNotFound(false);\n    setIsCurrentPartnership(false);\n\n    await axiosPrivate\n      .get(`companies/${eori_nr}/`)\n      .then((res) => {\n        setCompanies(res.data);\n\n        if (\n          partnerships.some(\n            (partnerships) => partnerships.partner.eori_nr == res.data.eori_nr\n          ) ||\n          auth.eori_nr == res.data.eori_nr\n        ) {\n          setIsCurrentPartnership(true);\n        }\n      })\n      .catch((err) => {\n        console.log(err);\n        setNotFound(true);\n      });\n  }\n\n  function handleSubmit(e) {\n    e.preventDefault();\n    //firma hinzufügen\n    console.log(\"Added Partner: \" + companies.eori_nr);\n    axiosPrivate\n      .post(\"/partnership/\", { added_partner: companies.eori_nr })\n      .then(\n        // setTestRerender(true),\n        // Reload Partern State\n        props.setNewPartner(!props.newPartner),\n        // Snackbar Alert\n        props.setSnackbarSuccess(true),\n        props.setSnackbarMessage(\"Partneranfrage gesendet.\"),\n        props.handleOpenSnackbar(),\n        // Modal schließen\n        props.toggleShow()\n      )\n      .catch((error) => {\n        console.error(\"There was an error!\", error);\n        // Snackbar definieren\n        props.setSnackbarSuccess(false);\n        props.setSnackbarMessage(\"Fehler beim Anfragen der Handelsbeziehung.\");\n        props.handleOpenSnackbar();\n        // Modal schließen\n        props.toggleShow();\n      });\n\n    //firma als partner hinterlegen\n  }\n\n  return (\n    <>\n      <MDBContainer>\n        <form id=\"partnerForm\" onSubmit={(e) => e.preventDefault()}>\n          <MDBInput\n            className=\"my-3\"\n            name=\"eori_nr\"\n            label=\"EORI-Nr.\"\n            type=\"number\"\n            required\n            onChange={(e) => setEoriNr(e.target.value)}\n          />\n          {eori_nr == \"\" ? (\n            <MDBBtn\n              block\n              className=\"mb-4\"\n              type=\"search\"\n              color=\"primary\"\n              disabled\n              onClick={(e) => handleEORISearch()}\n            >\n              <MDBIcon size=\"lg\" className=\"me-2\" fas icon=\"search\" />\n              Unternehmen suchen\n            </MDBBtn>\n          ) : (\n            <MDBBtn\n              block\n              className=\"mb-4\"\n              color=\"primary\"\n              type=\"submit\"\n              onClick={(e) => handleEORISearch()}\n            >\n              <MDBIcon size=\"lg\" className=\"me-2\" fas icon=\"search\" />\n              Unternehmen suchen\n            </MDBBtn>\n          )}\n        </form>\n        {notFound && <p> EORI-NR nicht gefunden, bitte erneut probieren</p>}\n        {companies?.name != undefined && (\n          <p>\n            {\" \"}\n            Treffer: <br />\n            <b>\n              {companies?.name} <br />\n              {companies?.street} <br />\n              {companies?.city_code} {companies?.city} <br />\n              {companies?.country_code}\n            </b>\n          </p>\n        )}\n        {isCurrentPartnership && (\n          <p>\n            {\" \"}\n            Eine Partnerschaft existiert mit diesem Unternehmen bereits oder es\n            ist ihr eigenes Unternehmen.\n          </p>\n        )}\n\n        {companies?.name != undefined && isCurrentPartnership == false ? (\n          <MDBBtn\n            block\n            className=\"mt-3\"\n            type=\"submit\"\n            onClick={(e) => handleSubmit(e)}\n            color=\"success\"\n          >\n            Anfrage stellen\n          </MDBBtn>\n        ) : null}\n      </MDBContainer>\n    </>\n  );\n}\n\nexport default PartnerForm;\n"]},"metadata":{},"sourceType":"module"}