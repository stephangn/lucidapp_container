{"ast":null,"code":"import Web3 from 'web3';\nimport Zollsystem from './smartcontracts/zollsystem.json';\nlet selectedAccount;\nlet zollsystemcontract;\nlet isinit; //initialize the web3 provider\n\nexport const init = async () => {\n  //get provider (metamask)\n  let provider = window.ethereum;\n\n  if (typeof provider !== 'undefined') {\n    provider.request({\n      method: 'eth_requestAccounts'\n    }).then(accounts => {\n      selectedAccount = accounts[0]; //returns the Pub Key of selected account in MetaMask\n\n      console.log(`Selected account is ${selectedAccount}`);\n    }).catch(err => {\n      console.log(err);\n      return;\n    });\n    window.ethereum.on('accountsChanged', function (accounts) {\n      selectedAccount = accounts[0];\n      console.log(`Selected account changed to ${selectedAccount}`);\n    });\n  } //creates new web3-object based on provider\n\n\n  const web3 = new Web3(provider);\n  const networkId = await web3.eth.net.getId(); //read the deployed contract to web3 contract-object \n\n  zollsystemcontract = new web3.eth.Contract(Zollsystem.abi, //returned by \"truffle migrate\"\n  Zollsystem.networks[networkId].address); //server/node IP\n\n  isinit = true;\n}; //returns the rechnungID\n\nexport async function createRechnung(_gesamtbetrag, _importeur, _waehrung, _datum, _rechnungsposten, _lieferkosten) {\n  if (!isinit) {\n    await init();\n  }\n\n  await zollsystemcontract.methods.createRechnung(_gesamtbetrag, _importeur, _waehrung, _datum, _rechnungsposten, _lieferkosten).send({\n    from: selectedAccount\n  });\n  return await zollsystemcontract.methods.createRechnung(_gesamtbetrag, _importeur, _waehrung, _datum, _rechnungsposten, _lieferkosten).call({\n    from: selectedAccount\n  });\n}\nexport async function uploadDokumentHash(_transaktionsID, _hash) {\n  if (!isinit) {\n    await init();\n  }\n\n  await zollsystemcontract.methods.createDokument(_transaktionsID, _hash).send({\n    from: selectedAccount\n  });\n  return await zollsystemcontract.methods.createDokument(_transaktionsID, _hash).call({\n    from: selectedAccount\n  });\n} //returns zollanmeldungID\n\nexport async function createZollanmeldung(_zoll, _rechnungID, _zollwert, _incoterms) {\n  if (!isinit) {\n    await init();\n  }\n\n  await zollsystemcontract.methods.createZollanmeldung(_zoll, _rechnungID, _zollwert, _incoterms).send({\n    from: selectedAccount\n  });\n  return await zollsystemcontract.methods.createZollanmeldung(_zoll, _rechnungID, _zollwert, _incoterms).call({\n    from: selectedAccount\n  });\n} //returns Zollanmeldung and Rechnung\n\nexport async function getZollanmeldung(_zollanmeldungID) {\n  if (!isinit) {\n    await init();\n  }\n\n  await zollsystemcontract.methods.getZollanmeldung(_zollanmeldungID).send({\n    from: selectedAccount\n  });\n  return await zollsystemcontract.methods.getZollanmeldung(_zollanmeldungID).call({\n    from: selectedAccount\n  });\n} //returns Dokumentenhash\n\nexport async function getDokumentenHash(_transaktionsID) {\n  if (!isinit) {\n    await init();\n  }\n\n  await zollsystemcontract.methods.getDokumentenHash(_transaktionsID).send({\n    from: selectedAccount\n  });\n  return await zollsystemcontract.methods.getDokumentenHash(_transaktionsID).call({\n    from: selectedAccount\n  });\n}","map":{"version":3,"sources":["/Users/stephan/Dropbox/Entwicklung/webdev/projektstudium/client/src/Web3Client.js"],"names":["Web3","Zollsystem","selectedAccount","zollsystemcontract","isinit","init","provider","window","ethereum","request","method","then","accounts","console","log","catch","err","on","web3","networkId","eth","net","getId","Contract","abi","networks","address","createRechnung","_gesamtbetrag","_importeur","_waehrung","_datum","_rechnungsposten","_lieferkosten","methods","send","from","call","uploadDokumentHash","_transaktionsID","_hash","createDokument","createZollanmeldung","_zoll","_rechnungID","_zollwert","_incoterms","getZollanmeldung","_zollanmeldungID","getDokumentenHash"],"mappings":"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","sourcesContent":["import Web3 from 'web3';\nimport Zollsystem from './smartcontracts/zollsystem.json';\n\nlet selectedAccount;\n\nlet zollsystemcontract;\n\nlet isinit;\n\n//initialize the web3 provider\nexport const init = async () => {\n    //get provider (metamask)\n    let provider = window.ethereum;\n\n    if (typeof provider !== 'undefined'){\n      provider\n      .request({ method: 'eth_requestAccounts' })\n      .then((accounts) => {\n          selectedAccount = accounts[0];\n          //returns the Pub Key of selected account in MetaMask\n        console.log(`Selected account is ${selectedAccount}`);\n      })\n      .catch((err) => {\n        console.log(err);\n        return;\n      });\n      window.ethereum.on('accountsChanged', function (accounts) {\n        selectedAccount = accounts[0];\n        console.log(`Selected account changed to ${selectedAccount}`);\n      });\n    }\n    //creates new web3-object based on provider\n    const web3 = new Web3(provider);\n    const networkId = await web3.eth.net.getId();\n\n    //read the deployed contract to web3 contract-object \n    zollsystemcontract = new web3.eth.Contract(\n        Zollsystem.abi, //returned by \"truffle migrate\"\n        Zollsystem.networks[networkId].address); //server/node IP\n    isinit=true;\n}; \n\n//returns the rechnungID\nexport async function createRechnung(_gesamtbetrag, _importeur, _waehrung, _datum, _rechnungsposten, _lieferkosten){\n    if (!isinit) {\n        await init();\n    }\n    await zollsystemcontract.methods.createRechnung(_gesamtbetrag, _importeur, _waehrung, _datum, _rechnungsposten, _lieferkosten).send({from: selectedAccount});\n    return await zollsystemcontract.methods.createRechnung(_gesamtbetrag, _importeur, _waehrung, _datum, _rechnungsposten, _lieferkosten).call({from: selectedAccount});\n}\n\nexport async function uploadDokumentHash(_transaktionsID, _hash){\n  if (!isinit) {\n      await init();\n  }\n  await zollsystemcontract.methods.createDokument(_transaktionsID, _hash).send({from: selectedAccount});\n  return await zollsystemcontract.methods.createDokument(_transaktionsID, _hash).call({from: selectedAccount});\n}\n\n\n//returns zollanmeldungID\n export async function createZollanmeldung(_zoll, _rechnungID, _zollwert, _incoterms){\n     if (!isinit) {\n         await init();\n     }\n     await zollsystemcontract.methods.createZollanmeldung(_zoll, _rechnungID, _zollwert, _incoterms).send({from: selectedAccount});\n     return await zollsystemcontract.methods.createZollanmeldung(_zoll, _rechnungID, _zollwert, _incoterms).call({from: selectedAccount});\n }\n\n //returns Zollanmeldung and Rechnung\n export async function getZollanmeldung(_zollanmeldungID){\n  if (!isinit) {\n      await init();\n  }\n  await zollsystemcontract.methods.getZollanmeldung(_zollanmeldungID).send({from: selectedAccount});\n  return await zollsystemcontract.methods.getZollanmeldung(_zollanmeldungID).call({from: selectedAccount});\n}\n\n//returns Dokumentenhash\nexport async function getDokumentenHash(_transaktionsID){\n  if (!isinit) {\n      await init();\n  }\n  await zollsystemcontract.methods.getDokumentenHash(_transaktionsID).send({from: selectedAccount});\n  return await zollsystemcontract.methods.getDokumentenHash(_transaktionsID).call({from: selectedAccount});\n}"]},"metadata":{},"sourceType":"module"}